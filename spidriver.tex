\documentclass{article}

\usepackage{booktabs}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{graphicx}
\usepackage{helvet}
\usepackage{hyperref}
\usepackage{tabularx}
\usepackage{xcolor}

\usepackage{listings}

\lstset{frame=tb,
  language=Java,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  % numberstyle=\tiny\color{gray},
  % keywordstyle=\color{blue},
  % commentstyle=\color{dkgreen},
  % stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3
}

\usepackage{framed}     % These needed for the code formatter
\usepackage{color}
\usepackage{fancyvrb}

% Use helvetica (sans) by default
\renewcommand{\familydefault}{\sfdefault}

% Greenish links
\hypersetup{
  colorlinks=true,
  linkcolor=blue!50!red,
  urlcolor=green!70!black
}

\setlength{\headheight}{40pt}
\setlength{\headsep}{0.2in}

\pagestyle{fancy}
\lhead{\includegraphics[width=0.2\textwidth]{img/logo}}
\chead{SPIDriver Datasheet}
\rhead{\thepage}
\cfoot{\textcopyright \the\year \ \ Excamera Labs}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}

\usepackage{array}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\newcommand{\heavyline}{\specialrule{1pt}{1pt}{1pt}}
\newcommand{\png}[2]{
\begin{figure}[H]
\begin{center}
\includegraphics[width=0.75\textwidth]{#1}
\caption{#2}
\end{center}
\end{figure}
}

\newcommand{\mach}[1]{\texttt{\textbf{#1}}}
\newcommand{\gap}{\vspace{10pt}}

\input{pyg.tex}

\begin{document}

\newpage
\begin{center}
\includegraphics[width=0.75\textwidth]{img/spidriver/main}
\end{center}
\tableofcontents
\listoffigures

\section{Overview}

SPIDriver is an easy-to-use tool for controlling SPI devices. It works with Windows, Mac, and Linux, and has a built-in color screen that shows a live logic-analyzer display of all SPI traffic.

\begin{center}
\includegraphics[width=0.75\textwidth]{img/termdriver/block}
\end{center}

\section{Features}
\begin{itemize}
\item live display shows you exactly what itâ€™s doing all the time
\item sustained SPI transfers at 500 Kbps
\item USB line voltage monitor to detect supply problems, to 0.01 V
\item target device high-side current measurement, to 5 mA
\item two auxiliary output signals, A and B
\item dedicated power out lines. two each of GND, 3.3 V and 5 V
\item all signals color coded to match jumper colors
\item all signals are 3.3 V, and are 5 V tolerant
\item uses an FTDI USB serial adapter, and Silicon Labs automotive-grade EFM8 controller
\item also reports uptime, temperature, and running CRC of all traffic
\item all sensors and signals controlled using a simple serial protocol
\item GUI, command-line, C/C++, and Python 2/3 host software provided for Windows, Mac, and Linux
\end{itemize}

\section{Software installation}

The source for all the SPIDriver software is the
\href{https://github.com/jamesbowman/spidriver}{repository}.
Available are:

\begin{itemize}
\item a Windows/Mac/Linux GUI
\item a Windows/Mac/Linux command-line
\item Python 2 and 3 bindings
\item Windows/Mac/Linux C/C++ bindings
\end{itemize}

Installation of the GUI and command-line utilities varies by platform.

\subsection{Windows}

This
\href{https://github.com/jamesbowman/spidriver/releases/download/v0.1.1/spidriver-installer.exe}{installer}
contains the GUI and command-line utilities.
The GUI shortcut is installed on the desktop:

\png{img/spidriver/spidriver-win-1}{Desktop shortcut icon}

launching it brings up the control window:

\png{img/spidriver/spidriver-win-2}{Windows GUI utility}

If there is only one serial device, 
the SPIDriver device should be automatically selected.
If there is more than one device, select its COM port from the pulldown menu at the top.
Once connected, you can control the signal lines and transmit hex values.

The command line utility \mach{spicl} is also installed. For example to display status information:

\begin{lstlisting}
  C:\>"c:\Program Files\Excamera Labs\SPIDriver\spicl.exe" COM3 i
  uptime 1625  4.810 V  45 mA  23.3 C
\end{lstlisting}

See below for more information on the command-line syntax.

\subsection{Linux}

The Linux GUI is available for download as
\href{https://github.com/jamesbowman/spidriver/releases/download/v0.1.0/spigui-linux64}{spigui-linux64}.
Or you can run the native Python GUI directly as shown below.

For the command-line tool, clone the
\href{https://github.com/jamesbowman/spidriver}{repository}, then do:
\begin{lstlisting}
    $ cd spidriver/c
    $ make -f linux/Makefile
    $ ./build/spicl /dev/ttyUSB0 i
\end{lstlisting}
and you should see something like:

\begin{lstlisting}
    uptime 2285  4.812 V  45 mA  23.6 C
\end{lstlisting}

\subsection{MacOS}

The MacOS GUI is available for download as
\href{https://github.com/jamesbowman/spidriver/releases/download/v0.1.0/spigui-macos}{spigui-macos}.
This is a Mac executable, so after downloading it do:
\begin{lstlisting}
    $ cd Downloads
    $ chmod a+x spigui-macos
    $ ./spigui-macos
\end{lstlisting}

Or you can run the native Python GUI directly as shown below.

For the command-line tool, clone the
\href{https://github.com/jamesbowman/spidriver}{repository}, then do:

\begin{lstlisting}
    cd spidriver/c
    make -f linux/Makefile
    ./build/spicl /dev/cu.usbserial-DO00QS8D i
\end{lstlisting}

(substituting your actual SPIDriver's ID for \mach{DO00QS8D})
and you should see something like:

\begin{lstlisting}
    uptime 2285  4.812 V  45 mA  23.6 C
\end{lstlisting}

Note that the port to use is \mach{/dev/cu.usbserial-XXXXXXXX}, as explained
\href{https://pbxbook.com/other/mac-tty.html}{here}.

\subsection{Python 2 and 3}

The SPIDriver bindings can be installed with \mach{pip} like this:

\begin{lstlisting}
    pip install spidriver
\end{lstlisting}

then from Python you can do:

\begin{lstlisting}
    >>> from spidriver import SPIDriver
    >>> s = SPIDriver("/dev/ttyUSB0") # or something like COM16 for Windows
    >>> s.sel()                       # start command
    >>> s.write([0x9f])               # command 9F is READ JEDEC ID 
    >>> list(s.read(3))               # read next 3 bytes
    [239, 64, 24]
    >>> s.unsel()                     # end command
    >>>
\end{lstlisting}

and you should see something like:

\png{img/spidriver/spidriver-flash}{}

under \mach{python/samples}.
The GUI (which uses wxPython) can be run with:

\begin{lstlisting}
    python spigui.py
\end{lstlisting}

which depending on your distribution looks something like this:

\png{img/spidriver/spidriver-gui-linux}{}

There are more examples in the 
\href{https://github.com/jamesbowman/spidriver/tree/master/python/samples}{samples folder in the repository}.

% C/C++
% -----
% 
% SPIDriver is contained in a single source file with a single header.
% Both are in `this subdirectory <https://github.com/jamesbowman/spidriver/tree/master/c/common>`_.
% Usage follows the Python API and is fairly self-explanatory.
% 
% The command-line tool ``spicl``
% -------------------------------
% 
% ``spicl`` is the same on all platforms.
% 
% The first parameter to the command is the serial port, which depends on your operating system.
% All following parameters are control commands. These are:
% 
% =========== ==================================================================
%   ``i``     display status information (uptime, voltage, current, temperature)
%   ``s``     SPI select
%   ``u``     SPI unselect
%   ``w``     write bytes to SPI
%   ``r N``   read N bytes from SPI
%   ``a 0/1`` Set A line
%   ``b 0/1`` Set B line
% =========== ==================================================================
% 
% For example the command:
% 
%   spicl /dev/ttyUSB0 s w 0x9f r 3 u
% 
% does the following:
% 
% ============ ===================
%  ``s``       SPI select
%  ``w 0x9f``  Write byte 0x9f
%  ``r 3``     Read 3 bytes from slave
%  ``u``       SPI unselect
% ============ ===================
% 

\newpage
\section{Raw protocol}

SPIDriver uses a serial protocol to send and receive SPI commands.
Connect to the SPIDriver at 460800 baud, 8 bits, no parity, 1 stop bit (460800 8N1).
Many SPIDriver commands are ASCII, you can control it
interactively from any terminal application that can connect at 460800
baud. For example typing u and s toggles the CS line and ? displays the
status info.
Commands are:

\gap\begin{tabular}{ll}
\hline
\mach{?}        & transmit status information (see below)        \\
\mach{e} $byte$ & echo $byte$       \\
\mach{s}        & select        \\
\mach{u}        & unselect        \\
\mach{a} $byte$ & set A output to 0/1       \\
\mach{b} $byte$ & set B output to 0/1       \\
\mach{x}        & disconnect from SPI bus       \\
\mach{0x80-bf}  & write and read 1-64 bytes       \\
\mach{0xc0-ff}  & write 1-64 bytes        \\ \hline
\end{tabular}\gap

So for example to select, then transfer two bytes 0x12, and unselect, the host sends 5 bytes:

\begin{framed}\begin{Verbatim}
s
0x81
0x12
0x34
u
\end{Verbatim}
\end{framed}

The command \mach{0x81} is a two byte send/receive, so two bytes are returned to the PC.
The status information is always 80 characters, space padded. For example:

{\scriptsize
\begin{framed}\begin{Verbatim}
[spidriver1 DO00QS8D 000007219 4.807 045 25.4 1 1 1 49c1                       ]
\end{Verbatim}
\end{framed}}

The fields are space-delimited:

\gap\begin{tabular}{ll}
\hline
spidriver1      & fixed identifier \\
serial          & serial code identifier \\
uptime          & SPIDriver uptime 0-999999999, in seconds \\
voltage         & USB bus voltage, in volts \\
current         & attached device current, in mA \\
temperature     & junction temperature, in C \\
CS              & CS line state \\
A               & A line state \\
B               & B line state \\
crc             & 16-bit CRC of all input and output bytes (CRC-16-CCITT) \\
\hline
\end{tabular}\gap

\newpage
\hypertarget{technical-specifications}{}
\hypertarget{technical-specifications}{%
\section{Specifications}\label{electrical-characteristics}}

\subsection{DC characteristics}
\vspace{10 pt}
{\renewcommand{\arraystretch}{1.2}% for the vertical padding

\begin{tabularx}{\linewidth}{XC{40pt}C{40pt}C{40pt}C{40pt}}
\heavyline
& min & typ & max & units \\ \heavyline

Voltage accuracy              && 0.01 && V            \\ \hline
Current accuracy              && 5 && mA              \\ \hline
Temperature accuracy          && $\pm$ 2 && C            \\ \hline
MISO & & & & \\
\hspace{10pt}low voltage & & & 0.6 & V \\
\hspace{10pt}high voltage & 2.7 &   & 5.8 & V \\ \hline
Output signal current (SCK, MOSI, CS, A, B)  &&& 8 & mA \\ \hline
Output current        & & & 470 & mA                  \\ \hline
Current consumption   & & 25 & & mA                   \\ \hline

\end{tabularx}}
\vspace{10 pt}

\subsection{AC characteristics}
\vspace{10 pt}

{\renewcommand{\arraystretch}{1.2}% for the vertical padding
\begin{tabularx}{\linewidth}{XC{40pt}C{40pt}C{40pt}C{40pt}}
\heavyline
& min & typ & max & units \\ \heavyline

SPI speed                     &495& 500 &505& Kbps   \\ \hline
Uptime accuracy               && 150 && ppm           \\ \hline
Uptime wrap                   && 31.7 && years        \\ \hline
Startup time & & & 200 & ms \\ \hline
\end{tabularx}}
\vspace{10 pt}

\section{Support information}

Technical and product support is available at
\href{mailto:support@excamera.com}{support@excamera.com}


\end{document}
